# ğŸ¨ Avatar í˜ì´ì§€ ì‚¬ìš©ë²•

## ğŸ“Œ ê°œìš”

`avatar.html`ì€ **ì±„íŒ… UI í˜•íƒœ**ë¡œ ì•„ë°”íƒ€ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•˜ëŠ” í˜ì´ì§€ì…ë‹ˆë‹¤.
ì‚¬ìš©ìê°€ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ Firebase Functionsë¥¼ í†µí•´ Runpodì—ì„œ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.

---

## ğŸ¯ ì£¼ìš” ê¸°ëŠ¥

### 1. **í”„ë¡¬í”„íŠ¸ ì…ë ¥ ì±„íŒ…**
- ëŒ€í™”í˜• UIë¡œ ìì—°ìŠ¤ëŸ¬ìš´ í”„ë¡¬í”„íŠ¸ ì…ë ¥
- ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ ìë™ í‘œì‹œ
- ì‹¤ì‹œê°„ ë©”ì‹œì§€ í‘œì‹œ

### 2. **Firebase ì´ë¯¸ì§€ ìƒì„±**
- sh í´ë”ì˜ ìµœì‹  ë¡œì§ ì—°ê²°
- ì‹¤ì œ Runpod API í˜¸ì¶œ
- ë¡œë”© ìƒíƒœ í‘œì‹œ

### 3. **ì‚¬ìš©ì ì¸ì¦ í†µí•©**
- ë¡œê·¸ì¸ ìƒíƒœ ìë™ í™•ì¸
- ì‚¬ìš©ì ì´ë¦„ í™˜ì˜ ë©”ì‹œì§€
- UID ê¸°ë°˜ ì´ë¯¸ì§€ ì €ì¥

---

## ğŸ”„ ì‚¬ìš© íë¦„

```
1. avatar.html ì ‘ì†
   â†“
2. í™˜ì˜ ë©”ì‹œì§€ + ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
   â†“
3. ì‚¬ìš©ìê°€ í”„ë¡¬í”„íŠ¸ ì…ë ¥
   â†“
4. "ì „ì†¡" ë²„íŠ¼ í´ë¦­ (ë˜ëŠ” Enter)
   â†“
5. ë¡œë”© íŒì—… í‘œì‹œ
   â†“
6. Firebase Functions â†’ Runpod â†’ ì´ë¯¸ì§€ ìƒì„±
   â†“
7. ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
   â†“
8. ë©”ì¸ í™”ë©´(My)ì—ì„œ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
```

---

## ğŸ’¬ ì±„íŒ… ë©”ì‹œì§€ ì˜ˆì‹œ

### **ì‹œìŠ¤í…œ ë©”ì‹œì§€** (ì™¼ìª½, ê²€ì€ ë°°ê²½)
```
ì•ˆë…•í•˜ì„¸ìš”, user@example.comë‹˜! ì›í•˜ì‹œëŠ” ì•„ë°”íƒ€ ì´ë¯¸ì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!

ex) ê·€ì—¬ìš´ ëŠë‚Œì˜ ì•„ì´ëŒ ì†Œë…€, ê¸ˆë°œ ê¸´ ì›¨ì´ë¸Œ, í¬ê³  ë°˜ì§ì´ëŠ” ë¶„í™ìƒ‰ ëˆˆë™ì, ë°ì€ í”¼ë¶€í†¤, ë¶„í™ìƒ‰ê³¼ í°ìƒ‰ì˜ ê·€ì—¬ìš´ ì˜ìƒ, ì•„ì´ëŒ ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼
```

### **ì‚¬ìš©ì ë©”ì‹œì§€** (ì˜¤ë¥¸ìª½, ë¶„í™ ë°°ê²½)
```
íŒŒë€ ë¨¸ë¦¬ì¹´ë½, ë…¸ë€ ëˆˆë™ì, í•™êµ êµë³µì„ ì…ì€ ê·€ì—¬ìš´ ì†Œë…€
```

### **ê²°ê³¼ ë©”ì‹œì§€** (ì™¼ìª½, ê²€ì€ ë°°ê²½)
```
âœ… ì´ë¯¸ì§€ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ë©”ì¸ í™”ë©´ì—ì„œ ë‹¤ìš´ë¡œë“œí•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ğŸ’¡ ë©”ì¸ í™”ë©´(My)ìœ¼ë¡œ ì´ë™í•˜ì—¬ "ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”!
```

---

## ğŸ› ï¸ ê¸°ìˆ  êµ¬ì¡°

### **íŒŒì¼ êµ¬ì„±**

```
avatar.html
  â†“ import
avatar-logic.js (ìƒˆë¡œ ìƒì„±)
  â†“ import
â”œâ”€ login-logic.js (ì¸ì¦)
â””â”€ image_model.js (ì´ë¯¸ì§€ ìƒì„±)
      â†“
  Firebase Functions
      â†“
  Runpod API
```

---

## ğŸ“ avatar-logic.js ì£¼ìš” í•¨ìˆ˜

### 1. `generateAvatarImage(promptText)`
```javascript
// ì•„ë°”íƒ€ ì´ë¯¸ì§€ ìƒì„± ìš”ì²­
const success = await generateAvatarImage("ê·€ì—¬ìš´ ì†Œë…€, íŒŒë€ ë¨¸ë¦¬");

// ë‚´ë¶€ ë™ì‘:
// 1. ë¡œê·¸ì¸ í™•ì¸
// 2. í”„ë¡¬í”„íŠ¸ ê²€ì¦
// 3. Firebase Functions í˜¸ì¶œ
// 4. ê²°ê³¼ ë°˜í™˜ (true/false)
```

### 2. `downloadAvatarImage()`
```javascript
// ìƒì„±ëœ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ
const success = await downloadAvatarImage();

// ë‚´ë¶€ ë™ì‘:
// 1. ë¡œê·¸ì¸ í™•ì¸
// 2. Firestoreì—ì„œ imagePath ì¡°íšŒ
// 3. Firebase Storageì—ì„œ ë‹¤ìš´ë¡œë“œ
```

### 3. `getCurrentUserInfo()`
```javascript
// í˜„ì¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
const userInfo = getCurrentUserInfo();

// ë°˜í™˜ê°’:
// {
//   uid: "abc123xyz",
//   email: "user@example.com",
//   displayName: "user@example.com"
// }
```

### 4. `getStatusMessage(status)`
```javascript
// ìƒíƒœ ë©”ì‹œì§€ ë°˜í™˜
const message = getStatusMessage('success');
// â†’ "âœ… ì´ë¯¸ì§€ ìƒì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ..."

// ì§€ì› ìƒíƒœ:
// - 'loading': ìƒì„± ì¤‘
// - 'success': ì™„ë£Œ
// - 'error': ì˜¤ë¥˜
// - 'unauthorized': ë¡œê·¸ì¸ í•„ìš”
// - 'empty': í”„ë¡¬í”„íŠ¸ ë¹„ì–´ìˆìŒ
```

---

## ğŸ¨ UI ìš”ì†Œ

### **ì±„íŒ… ì˜ì—­**
```html
<div id="chatHistory" class="chat-history">
  <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸° í‘œì‹œë¨ -->
</div>
```

### **ì…ë ¥ ì˜ì—­**
```html
<textarea id="inputField" class="input-field" 
          placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.">
</textarea>
```

### **ì „ì†¡ ë²„íŠ¼**
```html
<a class="save-button-link" onclick="sendMessage()">
  <div class="save-button-text">ì „ ì†¡</div>
</a>
```

### **ë¡œë”© íŒì—…**
```html
<div id="loadingPopup" class="loading-popup-box">
  <div class="loading-text">ì´ë¯¸ì§€ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤. . .</div>
</div>
```

---

## âš™ï¸ ì£¼ìš” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬

### **sendMessage() - ë©”ì‹œì§€ ì „ì†¡**
```javascript
async function sendMessage() {
  const messageText = inputField.value;
  
  // 1. ë¹ˆ ë©”ì‹œì§€ ì²´í¬
  if (!messageText.trim()) {
    addMessage('âš ï¸ í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'system');
    return;
  }
  
  // 2. ì‚¬ìš©ì ë©”ì‹œì§€ í‘œì‹œ
  addMessage(messageText, 'user');
  
  // 3. ë¡œë”© UI í‘œì‹œ
  showLoading();
  
  // 4. Firebase Functions í˜¸ì¶œ
  const success = await generateAvatarImage(messageText);
  
  // 5. ê²°ê³¼ ë©”ì‹œì§€ í‘œì‹œ
  if (success) {
    addMessage('âœ… ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ!', 'system');
  } else {
    addMessage('âŒ ì´ë¯¸ì§€ ìƒì„± ì‹¤íŒ¨', 'system');
  }
}
```

### **Enter í‚¤ ì „ì†¡**
```javascript
inputField.addEventListener('keypress', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
});

// Shift + Enter: ì¤„ë°”ê¿ˆ
// Enter: ì „ì†¡
```

---

## ğŸ” ì¸ì¦ ì²˜ë¦¬

### **ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸**
```javascript
import { isLoggedIn, getCurrentUserInfo } from './avatar-logic.js';

if (!isLoggedIn()) {
  alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
  // ë˜ëŠ” login.htmlë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
  window.location.href = 'login.html';
}
```

### **ì‚¬ìš©ì í™˜ì˜ ë©”ì‹œì§€**
```javascript
function initializeChat() {
  const userInfo = getCurrentUserInfo();
  let greeting = "ì•ˆë…•í•˜ì„¸ìš”!";
  
  if (userInfo) {
    greeting = `ì•ˆë…•í•˜ì„¸ìš”, ${userInfo.displayName}ë‹˜!`;
  }
  
  addMessage(greeting + " ì›í•˜ì‹œëŠ” ì•„ë°”íƒ€ ì´ë¯¸ì§€ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”!", 'system');
}
```

---

## ğŸ“Š ë°ì´í„° íë¦„

### **ì´ë¯¸ì§€ ìƒì„± í”Œë¡œìš°**
```
[avatar.html]
ì‚¬ìš©ì ì…ë ¥: "ê·€ì—¬ìš´ ì†Œë…€, íŒŒë€ ë¨¸ë¦¬"
    â†“
[avatar-logic.js]
generateAvatarImage(prompt)
    â†“
[image_model.js]
callGenerateImageFunction({ prompt: "..." })
    â†“
[Firebase Functions]
generate_image í˜¸ì¶œ
    â†“
[Runpod API]
ì´ë¯¸ì§€ ìƒì„± (3ë¶„ ì†Œìš”)
    â†“
[Firebase Storage]
users/{uid}/images/abc123.png ì €ì¥
    â†“
[Firestore]
users/{uid}/imagePath ì—…ë°ì´íŠ¸
    â†“
[avatar.html]
"âœ… ì™„ë£Œ!" ë©”ì‹œì§€ í‘œì‹œ
```

---

## ğŸ¯ ì‚¬ìš© ì˜ˆì‹œ

### **ì˜ˆì‹œ 1: ê¸°ë³¸ ì‚¬ìš©**
```
1. avatar.html ì—´ê¸°
2. í”„ë¡¬í”„íŠ¸ ì…ë ¥: "íŒŒë€ ë¨¸ë¦¬ì¹´ë½, ë…¸ë€ ëˆˆë™ìì˜ ì†Œë…€"
3. "ì „ì†¡" í´ë¦­
4. ë¡œë”© (3ë¶„)
5. "ì™„ë£Œ!" ë©”ì‹œì§€
6. index.htmlë¡œ ì´ë™ â†’ "ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ" í´ë¦­
```

### **ì˜ˆì‹œ 2: ìƒì„¸ í”„ë¡¬í”„íŠ¸**
```
í”„ë¡¬í”„íŠ¸ ì…ë ¥:
"1girl, blue hair, yellow eyes, school uniform, 
cute smile, anime style, high quality, 
soft lighting, detailed face"

ê²°ê³¼: ìƒì„¸í•œ ë¬˜ì‚¬ë¡œ ë” ì •í™•í•œ ì´ë¯¸ì§€ ìƒì„±
```

### **ì˜ˆì‹œ 3: ë¡œê·¸ì¸ ì—†ì´ ì ‘ì†**
```
1. avatar.html ì—´ê¸°
2. í”„ë¡¬í”„íŠ¸ ì…ë ¥
3. "ì „ì†¡" í´ë¦­
4. ì•Œë¦¼: "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤."
5. login.htmlë¡œ ì´ë™ ê¶Œì¥
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. **ë¡œê·¸ì¸ í•„ìˆ˜**
- ì´ë¯¸ì§€ ìƒì„±ì€ ë¡œê·¸ì¸ í›„ì—ë§Œ ê°€ëŠ¥
- UIDê°€ ì—†ìœ¼ë©´ ì´ë¯¸ì§€ ì €ì¥ ë¶ˆê°€

### 2. **ìƒì„± ì‹œê°„**
- Cold start: ì•½ 3ë¶„
- Warm start: ì•½ 1ë¶„
- ë¡œë”© íŒì—…ì´ í‘œì‹œë˜ëŠ” ë™ì•ˆ ê¸°ë‹¤ë ¤ì•¼ í•¨

### 3. **í”„ë¡¬í”„íŠ¸ ì‘ì„± íŒ**
```
ì¢‹ì€ ì˜ˆ:
"1girl, long blue hair, yellow eyes, school uniform, 
cute smile, anime style, high quality"

ë‚˜ìœ ì˜ˆ:
"ì˜ˆìœ ì—¬ì"
```

### 4. **ì—ëŸ¬ ì²˜ë¦¬**
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜: ë‹¤ì‹œ ì‹œë„
- ì¸ì¦ ì˜¤ë¥˜: ë¡œê·¸ì¸ í™•ì¸
- íƒ€ì„ì•„ì›ƒ: Firebase Functions ìƒíƒœ í™•ì¸

---

## ğŸ”§ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### **ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ ë³€ê²½**
```css
.chat-message.user {
  background: #FF019B;  /* ì‚¬ìš©ì ë©”ì‹œì§€ ìƒ‰ìƒ */
  color: #1B1B1B;
}

.chat-message.system {
  background: #1B1B1B;  /* ì‹œìŠ¤í…œ ë©”ì‹œì§€ ìƒ‰ìƒ */
  color: white;
}
```

### **ë¡œë”© ë©”ì‹œì§€ ë³€ê²½**
```javascript
// avatar-logic.js
export function getStatusMessage(status) {
  const messages = {
    loading: 'ğŸ¨ ë§ˆë²•ì„ ë¶€ë¦¬ëŠ” ì¤‘...',
    success: 'âœ¨ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤!',
    // ...
  };
  return messages[status];
}
```

---

## ğŸ“ˆ í–¥í›„ ê°œì„  ì‚¬í•­

### **ê³„íš ì¤‘ì¸ ê¸°ëŠ¥**
- [ ] ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
- [ ] ìƒì„± ì§„í–‰ë¥  í‘œì‹œ
- [ ] í”„ë¡¬í”„íŠ¸ ìë™ì™„ì„±
- [ ] íˆìŠ¤í† ë¦¬ ì €ì¥
- [ ] ì¦ê²¨ì°¾ê¸° í”„ë¡¬í”„íŠ¸

---

## ğŸ› ë¬¸ì œ í•´ê²°

### **Q: ì „ì†¡ ë²„íŠ¼ì„ ëˆŒëŸ¬ë„ ë°˜ì‘ì´ ì—†ì–´ìš”**
```
A: ì½˜ì†”(F12)ì„ ì—´ì–´ ì—ëŸ¬ í™•ì¸
   â†’ "User not authenticated" 
   â†’ login.htmlì—ì„œ ë¡œê·¸ì¸ í•„ìš”
```

### **Q: ë¡œë”©ì´ ëë‚˜ì§€ ì•Šì•„ìš”**
```
A: Firebase Functions íƒ€ì„ì•„ì›ƒ ê°€ëŠ¥ì„±
   1. ë„¤íŠ¸ì›Œí¬ ì—°ê²° í™•ì¸
   2. Firebase ì½˜ì†”ì—ì„œ ë¡œê·¸ í™•ì¸
   3. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ í›„ ì¬ì‹œë„
```

### **Q: "ì´ë¯¸ì§€ ìƒì„± ì™„ë£Œ" í›„ ë‹¤ìš´ë¡œë“œ ì•ˆ ë¼ìš”**
```
A: Firestoreì— ê²½ë¡œê°€ ì €ì¥ë˜ëŠ” ë° ì‹œê°„ ì†Œìš”
   1. 1~2ë¶„ ëŒ€ê¸°
   2. index.htmlì—ì„œ "ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ" í´ë¦­
   3. ì•ˆ ë˜ë©´ "ëª¨ë¸ ìƒì„± ìƒíƒœ í™•ì¸" ë²„íŠ¼ í´ë¦­
```

---

**ì‘ì„±ì¼**: 2025-11-02  
**íŒŒì¼ ìœ„ì¹˜**: `/src/tha4/app/avatar.html`, `/src/tha4/app/avatar-logic.js`

