<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>도전! 버튜버 - Voice</title>
    <style>
        @font-face { font-family: 'NanumMyeongjo'; src: url('path/to/NanumMyeongjo.ttf') format('truetype'); }
        @font-face { font-family: 'Javanese Text'; src: url('path/to/JavaneseText.ttf') format('truetype'); }
        body { margin: 0; padding: 0; width: 100vw; height: 100vh; overflow: hidden; }
        :root {
            --sidebar-width: 291px;
            --menu-box-width: 200px; --menu-spacer-gap: 15px; --menu-font-height: 26px;
            --width-my: 35px; --width-voice: 75px; --width-avatar: 75px; --width-voicechanger: 150px;
            --menu-offset: 45.5px; --bottom-divider-width: 150px; --circle-size: 72px;
            --toggle-icon-width: 48px; --toggle-icon-height: 28px;
        }
        .container { width: 100vw; height: 100vh; background: #FF019B; position: fixed; top: 0; left: 0; overflow: hidden; }
        #sidebar-toggle { width: 48px; height: 28px; position: absolute; right: 115px; top: 40px; display: block; cursor: pointer; z-index: 101; }
        .image-icon-top { width: 100%; height: 100%; display: block; }
        #sidebar-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.5); z-index: 99; display: none; opacity: 0; transition: opacity 0.3s; }
        /* avatar 스타일 사이드바 */
        .sidebar-container { position: fixed; top: 0; right: 0; width: 291px; height: 100%; z-index: 500; overflow: hidden; transition: transform 0.4s ease-in-out; transform: translateX(291px); }
        .sidebar-container.sidebar-open { transform: translateX(0); }
        .sidebar-header { width: 100%; height: 100px; background: black; position: relative; }
        .sidebar-main { width: 100%; height: calc(100% - 100px); background: #FF019B; position: relative; padding-top: 50px; }
        .menu-link { color: black; font-family: 'Javanese Text'; font-size: 22px; font-weight: 400; text-decoration: none; display: block; position: absolute; cursor: pointer; height: var(--menu-font-height); white-space: nowrap; }
        .divider { height: 1px; outline: 1px black solid; outline-offset: -0.50px; position: absolute; }
        .menu-my { left: var(--menu-offset); top: 53px; }
        .divider-1 { width: calc(var(--menu-box-width) - var(--width-my) - var(--menu-spacer-gap)); right: var(--menu-offset); top: 65.5px; }
        .menu-avatar { right: var(--menu-offset); top: 143px; text-align: right; }
        .divider-3 { width: calc(var(--menu-box-width) - var(--width-avatar) - var(--menu-spacer-gap)); left: var(--menu-offset); top: 155.5px; }
        .menu-voice { left: var(--menu-offset); top: 233px; }
        .divider-2 { width: calc(var(--menu-box-width) - var(--width-voice) - var(--menu-spacer-gap)); right: var(--menu-offset); top: 245.5px; }
        .menu-voicechanger { right: var(--menu-offset); top: 323px; text-align: right; font-size: 20px; }
        .divider-4 { width: calc(var(--menu-box-width) - var(--width-voicechanger) - var(--menu-spacer-gap)); left: var(--menu-offset); top: 335.5px; }
        .avatar-circle-wrapper { width: var(--circle-size); height: var(--circle-size); position: absolute; right: 28px; top: 150px; }
        .image-bottom { width: var(--menu-box-width); height: 230px; position: absolute; left: var(--menu-offset); top: 410px; }
        .slogan-1 { width: 100%; position: absolute; top: 670px; text-align: center; color: black; font-size: 13px; font-family: 'Javanese Text'; font-weight: 400; letter-spacing: 0.2em; }
        .slogan-2 { width: 100%; position: absolute; top: 705px; text-align: center; color: black; font-size: 10px; font-family: 'Javanese Text'; font-weight: 400; letter-spacing: 0.2em; }

        /* 중앙 전체 보이스 프레임 */
        .voice-container { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 85vw; max-width: 1216px; height: calc(100vh - 160px); background: #151515; border: 2px solid #2A2A2A; border-radius: 20px; overflow: hidden; box-shadow: 0 0 30px rgba(255, 1, 155, 0.25); }
        .voice-frame { width: 100%; height: 100%; border: none; display: none; }
        .voice-loading { color: #e5e5e5; font-family: 'NanumMyeongjo', serif; font-size: 16px; padding: 20px 28px; display: flex; flex-direction: column; gap: 8px; align-items: flex-start; }
        .voice-loading .title { font-size: 18px; font-weight: 700; }
        .voice-loading .hint { opacity: 0.9; font-size: 14px; }
        .voice-loading .dots::after { content: '…'; animation: blink 1.2s infinite steps(1, end); }
        @keyframes blink { 0% { content: '.'; } 33% { content: '..'; } 66% { content: '...'; } 100% { content: '.'; } }
    </style>
</head>
<body>
    <div id="sidebar-toggle" class="image-icon-link" title="메뉴 열기/닫기">
        <img class="image-icon-top" src="assets/image.png" alt="아이콘">
    </div>

    <div class="container"></div>

    <div id="sidebar-overlay"></div>
    <div id="sidebarContainer" class="sidebar-container sidebar-open">
        <div class="sidebar-header"></div>
        <div class="sidebar-main">
            <a id="menuMy" class="menu-link menu-my" href="index.html">My</a>
            <div id="divider1" class="divider divider-1"></div>
            <div class="avatar-circle-wrapper"><div style="width:72px;height:72px;border-radius:9999px;border:1px black solid;position:absolute;"></div></div>
            <a class="menu-link menu-avatar" href="avatar.html">Avatar</a>
            <div id="divider3" class="divider divider-3"></div>
            <a class="menu-link menu-voice" href="voice.html">Voice</a>
            <div id="divider2" class="divider divider-2"></div>
            <a class="menu-link menu-voicechanger" href="#">VoiceChanger</a>
            <div id="divider4" class="divider divider-4"></div>
            <div id="imageBottom" class="image-bottom"><img src="assets/image 3.png" alt="아바타 이미지"></div>
            <div id="slogan1" class="slogan-1">Y o u , b u t v i r t u a l !</div>
            <div id="slogan2" class="slogan-2">Turn imagination into identity</div>
        </div>
    </div>

    <!-- 전체 페이지를 쓰는 보이스 컨테이너 -->
    <div class="voice-container">
        <div id="voiceLoading" class="voice-loading">
            <div class="title">음성 학습 UI를 준비 중입니다<span class="dots"></span></div>
            <div class="hint">백엔드 서버와 웹 UI를 시작하는 데 약 10초 정도 걸릴 수 있어요.</div>
            <div class="hint">잠시만 기다려 주세요. 준비되면 화면이 자동으로 표시됩니다.</div>
        </div>
        <iframe id="voiceFrame" class="voice-frame" title="Voice Train"></iframe>
    </div>

    <script>
        // 사이드바 토글
        (function() {
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebarContainer = document.getElementById('sidebarContainer');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            function toggleSidebar() {
                const isOpening = !sidebarContainer.classList.contains('sidebar-open');
                sidebarContainer.classList.toggle('sidebar-open');
                if (isOpening) { sidebarOverlay.style.display = 'block'; setTimeout(() => sidebarOverlay.style.opacity = '1', 10); }
                else { sidebarOverlay.style.opacity = '0'; setTimeout(() => { sidebarOverlay.style.display = 'none'; }, 300); }
            }
            if (sidebarToggle) sidebarToggle.addEventListener('click', toggleSidebar);
            if (sidebarOverlay) sidebarOverlay.addEventListener('click', toggleSidebar);
            document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && sidebarWrapper.classList.contains('open')) toggleSidebar(); });
        })();

        // 음성 학습(voice_train) URL 준비 → iframe 로드
        (function() {
            try {
                const { ipcRenderer } = require('electron');
                const frame = document.getElementById('voiceFrame');
                const loading = document.getElementById('voiceLoading');
                ipcRenderer.send('ensure-voice-train');
                ipcRenderer.on('voice-train-ready', (event, payload) => {
                    try {
                        const url = (payload && payload.url) ? String(payload.url) : '';
                        if (url) {
                            if (loading) loading.style.display = 'none';
                            if (frame) { frame.style.display = 'block'; if (frame.src !== url) frame.src = url; }
                        }
                    } catch (_) {}
                });
                ipcRenderer.on('voice-train-error', (event, err) => {
                    if (loading) loading.textContent = '음성 학습 UI 준비 실패. 다시 시도해 주세요.';
                });
                // VoiceChanger 실행
                document.querySelectorAll('.menu-voicechanger').forEach((el) => {
                    el.addEventListener('click', (ev) => {
                        ev.preventDefault();
                        ipcRenderer.send('start-voice-changer');
                    });
                });
            } catch (_) {
                // 브라우저에서 직접 열렸을 때(개발 중) Vite dev 서버에 직접 접근 시도
                const frame = document.getElementById('voiceFrame');
                const loading = document.getElementById('voiceLoading');
                if (frame) { frame.src = 'http://localhost:3000'; frame.style.display = 'block'; }
                if (loading) loading.style.display = 'none';
            }
        })();
    </script>
</body>
</html>


